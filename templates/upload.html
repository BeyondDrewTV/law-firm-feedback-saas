{% extends "base.html" %}

{% block title %}Upload Reviews - Law Firm Insights<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.querySelector('.upload-form');
  if (!form) return;
  form.addEventListener('submit', function () {
    const btn = form.querySelector('button[type="submit"]');
    if (btn) {
      btn.disabled = true;
      btn.innerHTML = '‚è≥ Processing...';
    }
  });
});
</script>
{% endblock %}

{% block content %}
<section class="upload-page">
    <div class="container">
        <div class="page-header-internal">
            <div class="header-content">
                <h1>Upload Client Reviews</h1>
                <p class="header-subtitle">Import historical feedback in bulk from a CSV file</p>
            </div>
            <div class="header-actions">
                <a href="{{ url_for('dashboard') }}" class="btn btn-outline">
                    <span class="btn-icon">‚Üê</span> Back to Dashboard
                </a>
            </div>
        </div>

        <!-- Usage Notice -->
        {% if account_status is defined %}
        <div class="usage-notice">
            <div class="usage-info">
                <span class="usage-icon">üìä</span>
                <span class="usage-text">
                    <strong>Account Status:</strong> {{ account_status.display }}
                </span>
            </div>
            {% if not can_upload %}
                <a href="{{ url_for('pricing') }}" class="upgrade-link">No reports remaining ¬∑ View pricing ‚Üí</a>
            {% elif account_status.type == 'trial' %}
                <a href="{{ url_for('pricing') }}" class="upgrade-link">Upgrade for unlimited reports ‚Üí</a>
            {% elif account_status.type == 'onetime' %}
                <a href="{{ url_for('buy_one_time') }}" class="upgrade-link">Buy additional one-time reports ‚Üí</a>
            {% elif account_status.type in ['monthly', 'annual'] %}
                <span class="upgrade-link">Unlimited reports with your subscription</span>
            {% endif %}
        </div>
        {% endif %}

        <div class="content-grid">
            <!-- Instructions Card -->
            <div class="instructions-section">
                <div class="card">
                    <h3 class="card-title">CSV Format Requirements</h3>
                    <p>Your CSV file must contain the following columns in this exact order:</p>
                    <ul class="requirements-list">
                        <li>
                            <strong>date</strong>
                            <span class="requirement-detail">Date in YYYY-MM-DD format (e.g., 2026-01-15)</span>
                        </li>
                        <li>
                            <strong>rating</strong>
                            <span class="requirement-detail">Integer from 1 to 5</span>
                        </li>
                        <li>
                            <strong>review_text</strong>
                            <span class="requirement-detail">The full review content</span>
                        </li>
                    </ul>
                    
                    <h4 class="subsection-title">Example CSV:</h4>
                    <pre class="code-block">date,rating,review_text
2024-01-15,5,"Excellent legal services and professional communication."
2024-01-14,4,"Very satisfied with the outcome of my case."
2024-01-13,2,"Response times could be improved."</pre>
                    
                    <div class="info-box">
                        <span class="info-icon">‚ÑπÔ∏è</span>
                        <div class="info-content">
                            <strong>Important:</strong> The first row must be the header row. 
                            If your review text contains commas, enclose it in quotes.
                        </div>
                    </div>

                    <div class="info-box warning">
                        <span class="info-icon">‚ö†Ô∏è</span>
                        <div class="info-content">
                            <strong>Free Trial Limit:</strong> Your free trial includes {{ account_status.trial_limit if account_status and account_status.type == 'trial' else trial_limit | default(3) }} reports. 
                            Each upload counts as one report toward your limit.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upload Form Card -->
            <div class="upload-section">
                <div class="card">
                    <h3 class="card-title">Upload Your CSV File</h3>
                    <form method="POST" enctype="multipart/form-data" action="{{ url_for('upload') }}" class="upload-form">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="form-group">
                            <label for="file" class="form-label">Select CSV File</label>
                            <div class="file-upload-area">
                                <input type="file" 
                                       id="file" 
                                       name="file" 
                                       class="form-control-file" 
                                       accept=".csv"
                                       required>
                                <div class="file-upload-placeholder">
                                    <span class="upload-icon">üìÅ</span>
                                    <span class="upload-text">Choose a CSV file</span>
                                </div>
                            </div>
                            <small class="form-text">Maximum file size: 10MB</small>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-large btn-block" {% if not can_upload %}disabled{% endif %}>
                                <span class="btn-icon">üì§</span>
                                {% if can_upload %}
                                    Upload and Import
                                {% else %}
                                    No reports remaining ‚Äì View pricing
                                {% endif %}
                            </button>
                            <a href="{{ url_for('dashboard') }}" class="btn btn-outline btn-block">Cancel</a>
                        </div>
                    </form>
                </div>

                <!-- Help Section -->
                <div class="help-section">
                    <div class="help-item">
                        <span class="help-icon">üí°</span>
                        <div class="help-content">
                            <strong>Need a sample file?</strong>
                            <p>A sample CSV file is available in the <code>sample_data/</code> directory for testing.</p>
                        </div>
                    </div>
                    <div class="help-item">
                        <span class="help-icon">‚ùì</span>
                        <div class="help-content">
                            <strong>Having trouble?</strong>
                            <p>Make sure your CSV matches the required format exactly. Check that dates are in YYYY-MM-DD format and ratings are 1-5.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.querySelector('.upload-form');
  if (!form) return;
  form.addEventListener('submit', function () {
    const btn = form.querySelector('button[type="submit"]');
    if (btn) {
      btn.disabled = true;
      btn.innerHTML = '‚è≥ Processing...';
    }
  });
});
</script>
{% endblock %}
