{% extends "base.html" %}

{% block title %}Start Free Trial ‚Äî Law Firm Insights{% endblock %}

{% block content %}
<div class="auth-page">
  <div class="auth-card" style="max-width:480px">

    <div class="auth-card-header">
      <div class="auth-logo">‚öñÔ∏è</div>
      <h1>Create your firm account</h1>
      <p>3 full analysis reports included ‚Äî no credit card required</p>
    </div>

    <form method="POST" action="{{ url_for('register') }}" id="registerForm">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <div class="form-group">
        <label for="firm_name" class="form-label">Law firm name</label>
        <input
          type="text"
          id="firm_name"
          name="firm_name"
          class="form-control"
          required
          autofocus
          value="{{ request.form.get('firm_name', '') }}"
          placeholder="Smith &amp; Associates Law, PLLC">
        {% if errors and errors.firm_name %}
          <span class="form-text" style="color:var(--danger)">{{ errors.firm_name }}</span>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="email" class="form-label">Work email</label>
        <input
          type="email"
          id="email"
          name="email"
          class="form-control"
          required
          autocomplete="email"
          value="{{ request.form.get('email', '') }}"
          placeholder="you@lawfirm.com">
        {% if errors and errors.email %}
          <span class="form-text" style="color:var(--danger)">{{ errors.email }}</span>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="username" class="form-label">Username</label>
        <input
          type="text"
          id="username"
          name="username"
          class="form-control"
          required
          autocomplete="username"
          value="{{ request.form.get('username', '') }}"
          placeholder="jsmith">
        {% if errors and errors.username %}
          <span class="form-text" style="color:var(--danger)">{{ errors.username }}</span>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="password" class="form-label">Password</label>
        <input
          type="password"
          id="password"
          name="password"
          class="form-control"
          required
          autocomplete="new-password"
          placeholder="Minimum 8 characters">
        <div style="height:4px;border-radius:4px;background:var(--rule);margin-top:8px;overflow:hidden">
          <div id="strengthBar" style="height:100%;width:0;border-radius:4px;transition:all .3s"></div>
        </div>
        <span class="form-text">At least 8 characters ¬∑ One uppercase ¬∑ One number</span>
        <div class="info-box" style="margin-top:var(--s3)">
          <span style="font-size:1rem;flex-shrink:0">üîí</span>
          <div class="info-content">
            <strong>Your password is protected.</strong>
            Passwords are hashed with bcrypt and never stored in plain text.
            We don't sell or share your account data.
          </div>
        </div>
        {% if errors and errors.password %}
          <span class="form-text" style="color:var(--danger)">{{ errors.password }}</span>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="confirm_password" class="form-label">Confirm password</label>
        <input
          type="password"
          id="confirm_password"
          name="confirm_password"
          class="form-control"
          required
          autocomplete="new-password"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        <span class="form-text" id="matchMsg"></span>
        {% if errors and errors.confirm_password %}
          <span class="form-text" style="color:var(--danger)">{{ errors.confirm_password }}</span>
        {% endif %}
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary btn-block btn-lg" id="submitBtn">
          Create Account ‚Äî Free
        </button>
      </div>
    </form>

    <div class="auth-footer" style="margin-top:var(--s5)">
      <p>Already have an account?
        <a href="{{ url_for('login') }}" class="link-primary">Sign in ‚Üí</a>
      </p>
    </div>

    <div class="auth-trust">
      <span class="auth-trust-item">No credit card</span>
      <span class="auth-trust-item">256-bit encryption</span>
      <span class="auth-trust-item">Cancel anytime</span>
    </div>

  </div>
</div>

<script>
(() => {
  const pwd   = document.getElementById('password');
  const bar   = document.getElementById('strengthBar');
  const conf  = document.getElementById('confirm_password');
  const msg   = document.getElementById('matchMsg');

  pwd?.addEventListener('input', () => {
    const v = pwd.value;
    let s = 0;
    if (v.length >= 8) s++;
    if (/[a-z]/.test(v)) s++;
    if (/[A-Z]/.test(v)) s++;
    if (/[0-9]/.test(v)) s++;
    if (/[^a-zA-Z0-9]/.test(v)) s++;
    const pct   = (s / 5) * 100;
    const color = s <= 2 ? '#ef4444' : s <= 3 ? '#f59e0b' : '#15803d';
    bar.style.width = pct + '%';
    bar.style.background = color;
  });

  conf?.addEventListener('input', () => {
    if (!conf.value) { msg.textContent = ''; return; }
    if (conf.value === pwd.value) {
      msg.style.color = 'var(--success)';
      msg.textContent = '‚úì Passwords match';
    } else {
      msg.style.color = 'var(--danger)';
      msg.textContent = 'Passwords do not match';
    }
  });

  document.getElementById('registerForm')?.addEventListener('submit', (e) => {
    const btn = document.getElementById('submitBtn');
    if (btn && !btn.disabled) {
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Creating account‚Ä¶';
    }
  });
})();
</script>
{% endblock %}
